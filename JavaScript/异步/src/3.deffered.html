<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>异步</title>
</head>
<style>
  .dv {
    width: 400px;
    height: 200px;
    border-radius: 20px;
    background-color: #efefef;
  }
</style>
<script src="../node_modules/jquery/dist/jquery.min.js"></script>

<body>
  <div class="dv">

  </div>
</body>

<script>
  // var wait = function () {
  //   var task = function () {
  //       console.log('执行完成')
  //   }
  //   setTimeout(task, 2000)
  // }
  // wait();

  /**
   deferred对象具有的函数属性，并分为两组：
    1.dtd.resolve  dtd.reject  主动触发用来改变状态（成功或者失败）
    2.dtd.then(dtd.done,dtd.fail) 状态变化之后才会触发的监听函数
   */

  function waitHandle() {
    var dfd = $.Deferred()  // 创建一个 deferred 对象
    var wait = function (dfd) {  // 要求传入一个 deferred 对象
      var task = function () {
        console.log('执行完成')
        dfd.resolve()  // 表示异步任务已经完成
      }
      setTimeout(task, 2000)
      return dfd  // 要求返回 deferred 对象
    }

    // 注意，这里一定要有返回值
    return wait(dfd)
  }

  var w = waitHandle();
  w.then(function () {
    console.log('ok 1')
  }, function () {
    console.log('err 1')
  }).then(function () {
    console.log('ok 2')
  })

  /**
    Promise.resolve  deferred对象转换成ES6 的Promise对象
    原因：Promise.resolve能够将thenable对象转换为Promise`对象

   */
  const jsPromise = Promise.resolve($.ajax('../static/config/data.json'))
  jsPromise.then(data => { console.log(data) })

  // thenable 对象
  const thenable = {
    then: (resolve, reject) => {
      resolve(200)
    }
  }
  // thenable 对象可以转换为 Promise 对象
  const promise = Promise.resolve(thenable)
  promise.then(data => {})

</script>

</html>